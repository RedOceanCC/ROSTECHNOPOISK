<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π - –†–û–°–¢–ï–•–ù–û–ü–û–ò–°–ö</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result { 
            padding: 12px; 
            margin: 8px 0; 
            border-radius: 6px; 
            border-left: 4px solid;
            font-family: monospace;
            font-size: 14px;
        }
        .success { 
            background: #d4edda; 
            border-left-color: #28a745; 
            color: #155724; 
        }
        .error { 
            background: #f8d7da; 
            border-left-color: #dc3545; 
            color: #721c24; 
        }
        .info { 
            background: #d1ecf1; 
            border-left-color: #17a2b8; 
            color: #0c5460; 
        }
        .btn { 
            padding: 12px 20px; 
            margin: 8px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
            font-weight: 500;
            background: #007bff; 
            color: white; 
        }
        #console-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h1>
        
        <div class="test-controls">
            <button class="btn" onclick="runDiagnostics()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
            <button class="btn" onclick="testNotificationClick()">üîî –¢–µ—Å—Ç –∫–ª–∏–∫–∞ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º</button>
            <button class="btn" onclick="clearConsole()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
        </div>
        
        <div id="console-output"></div>
        <div id="test-results"></div>
    </div>

    <script>
        let consoleOutput = document.getElementById('console-output');
        let testResults = document.getElementById('test-results');

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log
        const originalConsole = console.log;
        console.log = function(...args) {
            originalConsole.apply(console, arguments);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.error
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, arguments);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `<span style="color: #f00;">[${timestamp}] ERROR: ${message}</span>\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            testResults.appendChild(div);
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
            testResults.innerHTML = '';
        }

        function runDiagnostics() {
            clearConsole();
            console.log('üîß –ù–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            console.log('üìä –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:');
            console.log('  window.notifications:', typeof window.notifications);
            console.log('  window.notificationCenter:', typeof window.notificationCenter);
            console.log('  window.notificationManager:', typeof window.notificationManager);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            console.log('üîç DOM —ç–ª–µ–º–µ–Ω—Ç—ã:');
            const notificationBtns = document.querySelectorAll('.notifications-btn');
            console.log('  –ö–Ω–æ–ø–∫–∏ .notifications-btn:', notificationBtns.length);
            
            notificationBtns.forEach((btn, i) => {
                console.log(`    –ö–Ω–æ–ø–∫–∞ ${i + 1}: ID="${btn.id}", classes="${btn.className}"`);
            });
            
            const modal = document.getElementById('notifications-modal');
            console.log('  –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ #notifications-modal:', !!modal);
            
            if (modal) {
                console.log('    –ö–ª–∞—Å—Å—ã –º–æ–¥–∞–ª–∞:', modal.className);
                console.log('    –°–∫—Ä—ã—Ç–æ:', modal.classList.contains('hidden'));
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π
            console.log('üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...');
            if (window.notificationCenter) {
                console.log('  NotificationCenter –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                console.log('  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', window.notificationCenter.notifications?.length || 0);
            } else {
                console.error('  NotificationCenter –ù–ï –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ API
            console.log('üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ API...');
            fetch('http://localhost:3001/api/health')
                .then(response => {
                    console.log('  –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('  API –∑–¥–æ—Ä–æ–≤—å—è:', data.success ? '‚úÖ OK' : '‚ùå ERROR');
                    console.log('  –î–∞–Ω–Ω—ã–µ API:', data);
                    addResult('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ - —Å–º. –∫–æ–Ω—Å–æ–ª—å', 'success');
                })
                .catch(error => {
                    console.error('  –û—à–∏–±–∫–∞ API:', error.message);
                    console.log('  üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3001');
                    addResult('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏ - —Å–º. –∫–æ–Ω—Å–æ–ª—å', 'error');
                });
        }

        function testNotificationClick() {
            console.log('üîî –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
            
            const btn = document.querySelector('.notifications-btn');
            if (btn) {
                console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞, —ç–º—É–ª–∏—Ä—É–µ–º –∫–ª–∏–∫...');
                btn.click();
                
                setTimeout(() => {
                    const modal = document.getElementById('notifications-modal');
                    if (modal && !modal.classList.contains('hidden')) {
                        console.log('üéâ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã–ª–æ—Å—å —É—Å–ø–µ—à–Ω–æ!');
                        addResult('‚úÖ –ö–ª–∏–∫ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    } else {
                        console.error('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å');
                        addResult('‚ùå –ö–ª–∏–∫ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                    }
                }, 500);
            } else {
                console.error('‚ùå –ö–Ω–æ–ø–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                addResult('‚ùå –ö–Ω–æ–ø–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(runDiagnostics, 1000);
        });
    </script>
</body>
</html>
