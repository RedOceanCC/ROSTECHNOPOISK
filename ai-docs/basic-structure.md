# Базовая структура проекта РОСТЕХНОПОИСК

## Обзор

РОСТЕХНОПОИСК - веб-платформа для аренды спецтехники с аукционной системой подачи заявок. Проект построен по архитектуре клиент-сервер с использованием Node.js/Express для бэкенда и нативного JavaScript для фронтенда.

## Архитектура проекта

### Основные компоненты

- **Backend** - API сервер на Node.js с Express фреймворком
- **Frontend** - SPA приложение на нативном JavaScript
- **База данных** - SQLite с возможностью масштабирования
- **Конфигурация** - Система переменных окружения для разных сред

## Структура файлов

### Корневая директория

```
Despair/
├── app.js                    # Основной клиентский JavaScript
├── index.html               # Главная HTML страница
├── style.css                # Основные стили приложения
├── frontend-server.js       # Простой HTTP сервер для фронтенда
├── notifications.js         # Система уведомлений
├── validation.js           # Клиентская валидация форм
├── package.json            # Конфигурация корневого проекта
└── production-config.env   # Продакшн конфигурация
```

### Backend (`/backend`)

Серверная часть приложения с модульной архитектурой:

#### Главные файлы
- `server.js` - Основной сервер приложения
- `package.json` - Зависимости и скрипты бэкенда

#### Конфигурация (`/config`)
- `database.js` - Конфигурация базы данных для разных сред

#### Модели (`/models`)
- `Database.js` - Основной класс для работы с SQLite
- `User.js` - Модель пользователей
- `Company.js` - Модель компаний
- `Equipment.js` - Модель техники
- `RentalRequest.js` - Модель заявок на аренду
- `RentalBid.js` - Модель ставок в аукционах

#### Роуты (`/routes`)
- `auth.js` - Аутентификация пользователей
- `users.js` - Управление пользователями
- `companies.js` - Управление компаниями
- `equipment.js` - Управление техникой
- `requests.js` - Заявки на аренду
- `bids.js` - Ставки в аукционах
- `telegram.js` - Telegram интеграция
- `logs.js` - Системные логи

#### Сервисы (`/services`)
- `AuctionService.js` - Логика аукционной системы
- `NotificationService.js` - Система уведомлений

#### Middleware (`/middleware`)
- `auth.js` - Аутентификация и авторизация
- `logging.js` - Логирование запросов

#### Утилиты (`/utils`)
- `logger.js` - Централизованное логирование
- `validation.js` - Серверная валидация
- `csvImporter.js` - Импорт данных из CSV
- `telegramHelper.js` - Вспомогательные функции для Telegram

### База данных (`/backend/database`)

#### Основные файлы
- `schema.sql` - Схема таблиц базы данных
- `init.js` - Инициализация базы данных
- `migrate.js` - Система миграций для разработки
- `migrate-prod.js` - Миграции для продакшна

#### Миграции (`/migrations`)
- `001_equipment_types.sql` - Типы техники
- `20250815222252_add_user_settings_table.sql` - Настройки пользователей

### Конфигурационные шаблоны (`/config-templates`)

Шаблоны переменных окружения для разных сред:
- `env.local.template` - Локальная разработка
- `env.development.template` - Среда разработки
- `env.production.template` - Продакшн среда

### Документация (`/dock`)

Техническая документация:
- `BUILD.md` - Инструкции по сборке
- `DEPLOY-GUIDE.md` - Руководство по развертыванию
- `QUICK-START.md` - Быстрый старт
- `MIGRATION-GUIDE.md` - Руководство по миграциям

### Тестирование (`/tests`)

#### Структура тестов
- `/backend` - Тесты серверной части
  - `/models` - Тесты моделей данных
  - `/routes` - Тесты API маршрутов
- `/frontend` - Тесты клиентской части
  - `/notifications` - Тесты системы уведомлений
  - `/timers` - Тесты таймеров аукционов
- `/e2e` - Интеграционные тесты
- `/config` - Конфигурация тестирования

#### Ключевые файлы тестов
- `run-all-tests.js` - Запуск всех тестов
- `config/jest.setup.js` - Настройка Jest
- `config/setup-test-db.js` - Подготовка тестовой БД

## Схема базы данных

### Основные таблицы

1. **companies** - Компании (владельцы и заказчики техники)
2. **users** - Пользователи системы с ролями (admin, owner, manager)
3. **company_partnerships** - Связи между компаниями для доступа к аукционам
4. **equipment** - Техника, принадлежащая владельцам
5. **rental_requests** - Заявки на аренду техники
6. **rental_bids** - Ставки владельцев в аукционах
7. **notifications** - Уведомления пользователей

### Ключевые связи

- Пользователи привязаны к компаниям
- Техника принадлежит пользователям-владельцам
- Заявки создаются менеджерами
- Ставки подаются владельцами техники
- Партнерства определяют доступ к аукционам

## Ключевые модули

### Система аутентификации
- Сессионная аутентификация через Express Session
- Роли: администратор, владелец техники, менеджер
- Middleware для проверки доступа

### Аукционная система
- Автоматическое создание аукционов при подаче заявки
- Скрытые ставки с раскрытием по истечении времени
- Cron-задачи для закрытия просроченных аукционов
- Система таймеров на клиенте

### Система уведомлений
- Уведомления о новых заявках
- Результаты аукционов
- Telegram интеграция (опционально)
- Центр уведомлений в интерфейсе

### Валидация данных
- Клиентская валидация форм
- Серверная валидация API запросов
- Проверка прав доступа

## Развертывание

### Среды
- **Local** - Локальная разработка
- **Development** - Среда разработки
- **Production** - Продакшн среда

### Конфигурация
- Переменные окружения для каждой среды
- Автоматические миграции БД при запуске
- Настройка CORS для разных доменов
- Логирование с разными уровнями детализации

## Технологический стек

### Backend
- Node.js + Express
- SQLite база данных
- Express Session для аутентификации
- node-cron для фоновых задач
- Axios для HTTP запросов
- bcryptjs для хеширования паролей

### Frontend
- Нативный JavaScript (ES6+)
- CSS с системой дизайн-токенов
- Модульная архитектура компонентов
- Система уведомлений
- Таймеры аукционов

### Утилиты разработки
- Jest для тестирования
- Nodemon для автоперезагрузки
- Puppeteer для e2e тестов
- Системы логирования и мониторинга
