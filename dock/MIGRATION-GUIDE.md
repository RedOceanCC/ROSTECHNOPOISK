# üóÑÔ∏è –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ú–ò–ì–†–ê–¶–ò–Ø–ú –ë–ê–ó–´ –î–ê–ù–ù–´–•

## üìã **–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã**

–°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –ö–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `schema_migrations`.

---

## üöÄ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**

### **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migrate

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π  
npm run migrate:status

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
npm run migrate:create "–ù–∞–∑–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏"
```

### **–ü—Ä–æ–¥–∞–∫—à–Ω:**
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–¥–µ
NODE_ENV=production npm run migrate

# –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ –ø—Ä–æ–¥–µ
NODE_ENV=production npm run migrate:status
```

---

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π**

```
backend/database/migrations/
‚îú‚îÄ‚îÄ 001_equipment_types.sql          # –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ 20250115120000_add_user_roles.sql # –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è  
‚îî‚îÄ‚îÄ 20250115130000_update_prices.sql  # –ï—â–µ –æ–¥–Ω–∞ –Ω–æ–≤–∞—è
```

### **–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π:**
- **–ò–º—è —Ñ–∞–π–ª–∞:** `YYYYMMDDHHMMSS_–æ–ø–∏—Å–∞–Ω–∏–µ.sql`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:** SQL –∫–æ–º–∞–Ω–¥—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞:** UTF-8

---

## ‚úèÔ∏è **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π**

### **1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:**
```bash
npm run migrate:create "Add telegram notifications table"
```

### **2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:**
```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è: Add telegram notifications table
-- –î–∞—Ç–∞: 2025-01-15
-- –û–ø–∏—Å–∞–Ω–∏–µ: –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

-- –î–æ–±–∞–≤—å—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã –Ω–∏–∂–µ:
CREATE TABLE telegram_settings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  telegram_id VARCHAR(50),
  notifications_enabled BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE INDEX idx_telegram_user_id ON telegram_settings(user_id);
```

### **3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**
```bash
npm run migrate
```

---

## üîÑ **–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å**

### **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:**
1. –í–Ω–æ—Å–∏—à—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º—É ‚Üí —Å–æ–∑–¥–∞–µ—à—å –º–∏–≥—Ä–∞—Ü–∏—é
2. –¢–µ—Å—Ç–∏—Ä—É–µ—à—å –ª–æ–∫–∞–ª—å–Ω–æ: `npm run migrate`
3. –ö–æ–º–º–∏—Ç–∏—à—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ git
4. –ù–∞ –ø—Ä–æ–¥–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –¥–µ–ø–ª–æ–π

### **–ü—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ –ø—Ä–æ–¥:**
1. –ö–æ–¥ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. PM2 –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ  
3. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏
4. –ù–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è

---

## üìä **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π**

–°–∏—Å—Ç–µ–º–∞ –≤–µ–¥–µ—Ç —Ç–∞–±–ª–∏—Ü—É `schema_migrations`:
```sql
CREATE TABLE schema_migrations (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  version VARCHAR(255) NOT NULL UNIQUE,     -- –ò–º—è —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
  executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  execution_time_ms INTEGER,                -- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  environment VARCHAR(50) DEFAULT 'development'  -- local/development/production
);
```

### **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞:**
```bash
npm run migrate:status

# –í—ã–≤–æ–¥:
üìä –°–¢–ê–¢–£–° –ú–ò–ì–†–ê–¶–ò–ô:
==================
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ 001_equipment_types
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ 20250115120000_add_user_roles  
‚è≥ –û–∂–∏–¥–∞–µ—Ç 20250115130000_update_prices

üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 2 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, 1 –æ–∂–∏–¥–∞–µ—Ç
```

---

## üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞—Ç**

### **–ü—Ä–∞–≤–∏–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π:**
1. **–¢–æ–ª—å–∫–æ –î–û–ë–ê–í–õ–Ø–Æ–©–ò–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –∫–æ–ª–æ–Ω–∫–∏, –∏–Ω–¥–µ–∫—Å—ã)
2. **–ù–ï —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ** –±–µ–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–æ–ø–∏–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –¥–∞–Ω–Ω—ã—Ö**
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IF NOT EXISTS** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü

### **–ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:**
```sql
-- ‚úÖ –•–û–†–û–®–û - –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É
ALTER TABLE users ADD COLUMN avatar_url VARCHAR(255) DEFAULT NULL;

-- ‚úÖ –•–û–†–û–®–û - —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π  
CREATE TABLE IF NOT EXISTS user_sessions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  session_token VARCHAR(255) NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ‚ùå –ü–õ–û–•–û - —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
-- DROP TABLE old_table;

-- ‚ùå –ü–õ–û–•–û - –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
-- ALTER TABLE users DROP COLUMN phone;
```

### **–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π:**
–í —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ –Ω–µ—Ç. –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ:
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –±–∞–∑—ã
2. –ó–∞—Ñ–∏–∫—Å–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é 
3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â—É—é –º–∏–≥—Ä–∞—Ü–∏—é

---

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π**

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏–∑ `NODE_ENV`:

### **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
```bash
NODE_ENV=local npm run migrate
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç: .env.local
# –ë–∞–∑–∞: ./database/rostechnopolsk.db
```

### **–ü—Ä–æ–¥–∞–∫—à–Ω:**
```bash
NODE_ENV=production npm run migrate  
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç: .env.production
# –ë–∞–∑–∞: –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∏–∑ DB_PATH
```

---

## üö® **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º**

### **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
npm run migrate:status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f backend/logs/combined.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –±–∞–∑—ã
ls -la backend/database/
```

### **–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQL –≤ —Ñ–∞–π–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ

### **–ë–∞–∑–∞ "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞":**
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –±–∞–∑—É
lsof backend/database/rostechnopolsk.db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
pm2 restart rostechnopolsk
```

---

## üìã **–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π**

- [ ] –§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ `npm run migrate:create`
- [ ] SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (ADD COLUMN, CREATE TABLE IF NOT EXISTS)
- [ ] –ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –§–∞–π–ª –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ git
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: `npm run migrate:status`

---

## üéØ **–ò—Ç–æ–≥: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã**

‚úÖ **–í –¥–µ–≤–µ –¥–æ–±–∞–≤–∏–ª –∫–æ–ª–æ–Ω–∫—É** ‚Üí —Å–æ–∑–¥–∞–ª –º–∏–≥—Ä–∞—Ü–∏—é ‚Üí –∑–∞–∫–æ–º–º–∏—Ç–∏–ª  
‚úÖ **–ù–∞ –ø—Ä–æ–¥–µ –¥–µ–ø–ª–æ–π** ‚Üí –º–∏–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∞—Å—å  
‚úÖ **–°—Ö–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞** –º–µ–∂–¥—É –≤—Å–µ–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏  
‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ `schema_migrations`  

**–ë–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö SQL –∫–æ–º–∞–Ω–¥ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ!** üéâ
